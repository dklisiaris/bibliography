<% pages = {fa('home') => root_url, t('books.label') => books_url, @book.title => nil} %>

<%= cell(:navigation).call(:content_header, title: @book.title, breadcrumbs: pages) %>

<div class="row">
   <div class="col-sm-10 col-sm-offset-1">
      <div class="block full">
        <div class="block-title">
          <div class="block-options pull-right">   
            <%= cell(:navigation).call(:btn_link_to, name: fa('plus'), url: 'add-tÎ¿-collection', tooltip: t('add_to_collection')) %>    
            <% if policy(@book).update? %>            
            <%= cell(:navigation).call(:btn_link_to, name: fa('pencil'), url: edit_book_path(@book), tooltip: t('books.edit'), style: 'success') %>
            <% end %>                
          </div>
          <h2><%= detone(@book.title) %></h2>
        </div>  

        <div class="row">
          <div class="col-sm-3">
            <div class="row">            
              <div class="widget">
                <div class="widget-content themed-background-muted text-right clearfix">
                  <%= image_tag(@book.cover, alt: "book_cover", class: "img-thumbnail")  %>
                </div>
                <div class="widget-content themed-background-muted text-center">

                <%= render partial: 'books/collections_manager_btn', locals: {book: @book, full_size: true} %>
                <hr>

                <div class="progress progress-mini">
                  <div class="progress-bar progress-bar-success recommendations-bar" role="progressbar" aria-valuenow=<%= "#{@likes_count}" %> aria-valuemin="0" aria-valuemax=<%= "#{@likes_count+@dislikes_count}" %> style=<%= (@likes_count+@dislikes_count)>0 ? "width:#{(@likes_count/(@likes_count+@dislikes_count))*100}%" : "width:0%" %>></div>
                </div>

                <%= button_tag :onclick => "javascript:like(#{@book.id})",                  
                "data-toggle" => "tooltip", 
                "data-placement" => "top",
                type: "button", 
                title: current_user.likes?(@book) ? t('books.remove_recommendation') : t('books.recommend'), 
                class: "btn btn-xs btn-like btn-effect-ripple #{current_user.likes?(@book) ? 'btn-success' : 'btn-default'}" do %>      
                  <i class="fa fa-thumbs-up"></i><strong><span><%= " #{@likes_count}" %></span></strong>
                <% end %>

                <%= button_tag :onclick => "javascript:dislike(#{@book.id})",
                "data-toggle" => "tooltip", 
                "data-placement" => "top",
                type: "button", 
                title: current_user.dislikes?(@book) ? t('books.remove_recommendation') : t('books.not_recommend'), 
                class: "btn btn-xs btn-dislike btn-effect-ripple #{current_user.dislikes?(@book) ? 'btn-danger' : 'btn-default'}" do %>      
                  <i class="fa fa-thumbs-down"></i><strong><span><%= " #{@dislikes_count}" %></span></strong>
                <% end %>                                  
                <hr>

                <div class="row text-center">
                  <div class="col-xs-6">
                    <h4 class="widget-heading"><small><%= t 'collections' %></small><br><%= @bookshelves_count %></h4>
                  </div>
                  <div class="col-xs-6">
                    <h4 class="widget-heading"><small><%= t 'books.views' %></small><br><%= @views_count %></h4>
                  </div>
                  <div class="col-xs-6">
                    <h4 class="widget-heading"><small><%= t 'books.visitors' %></small><br><%= @viewers_count %></h4>
                  </div>
                </div>
                </div>
              </div>
            </div>                       
          </div>  
          <div class="col-sm-9">
            <h2><%= @book.title %><br><small><%= @book.subtitle %></small></h2>
            <hr>
            
            <h4><%= @book_presenter.writers %></h4>
            <h4><%= @book_presenter.contributors %></h4>                                  
            <hr>
            
            <article class="description">
              <%= @book.description.html_safe if @book.description.present? %>
            </article>
            <br>
            <div class="block full">
              <div class="block-title">
                <ul class="nav nav-tabs" data-toggle="tabs">
                  <li class="active"><a href="#block-tabs-desc"><%= t('books.description') %></a></li>
                  <li><a href="#block-tabs-marc"><%= t('books.marc_view') %></a></li>
                  <li><a href="#block-tabs-isbd"><%= t('books.isbd_view') %></a></li>                  
                </ul>
              </div>
              <div class="tab-content">
                <div class="tab-pane active" id="block-tabs-desc">
                  <table class="table table-striped">
                    <tbody>
                      <%= @book_presenter.trow(t('books.publication'), @book_presenter.publication) %>

                      <%= @book_presenter.trow(t('books.format'), @book.format.humanize) if @book.format %>                

                      <%= @book_presenter.trow(t('books.original_title'), @book.original_title) %>

                      <%= @book_presenter.trow(t('books.original_language'), @book.original_language) %>

                      <%= @book_presenter.trow(t('books.series'), @book.series_name) %>

                      <%= @book_presenter.trow(t('books.genres'), @book_presenter.genres) %>

                      <%= @book_presenter.trow(t('collections'), @book_presenter.collections(@in_shelves)) if user_signed_in? %>                                          
                      <%= @book_presenter.trow(t('books.isbn'), @book.isbn) %>

                      <%= @book_presenter.trow(t('books.isbn13'), @book.isbn13) %>
  
                      <%= @book_presenter.trow(t('books.ismn'), @book.ismn) %>

                      <%= @book_presenter.trow(t('books.issn'), @book.issn) %>  

                      <%= @book_presenter.trow(t('books.physical_desc'), @book_presenter.physical_description) %> 

                      <%= @book_presenter.trow(t('books.price'), @book_presenter.price) %>
                    </tbody>
                  </table>
                </div>
                <div class="tab-pane" id="block-tabs-marc">
                  <%= t('books.marc_view') %>
                </div>
                <div class="tab-pane" id="block-tabs-isbd">
                  <%= t('books.isbd_view') %>
                </div>                
              </div>
            </div>                                    
          </div>  
        </div>          
      </div>
  </div>
</div>

<%= render 'home/widgets/collections_manager' %>

<%= link_to 'Back', books_path %>
